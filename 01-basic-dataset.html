<!DOCTYPE html>
<html>
<head>
    <title>Caltech Library</title>
    <link rel="stylesheet" href="css/site.css">
</head>
<body>
<header>
<a href="http://library.caltech.edu"><img src="img/liblogo.gif" alt="Library logo"></a>
</header>
<nav>
<ul>
<li><a href=".">Lesson</a></li>
<li><a href="00-intro-json-apis.html">Intro</a></li>
<li><a href="01-basic-dataset.html">Basic Dataset</a></li>
<li><a href="02-combining-apis.html">Combining APIs with Dataset</a></li>
<li><a href="mailto:library@caltech.edu">Contact Us</a></li>
</ul>

</nav>

<section>
<h1>Basic Dataset</h1>

<p>20 min</p>

<hr />

<p>Learning Objectives:</p>

<ul>
<li>Use basic dataset commands</li>
</ul>

<hr />

<h2>Dataset</h2>

<p>Dataset is a set of tools for managing multiple JSON documents in an efficient
way.  These JSON documents are stored as files, and the operations dataset
performs are transpartent even if you&rsquo;re not using the application.  You have
the option to store files on your local machine or with a cloud storage
provider like Amazon Web Services or Google.</p>

<p>#Basic Operations</p>

<p>The first step in using dataset is to define a collection.  This is a way to
organize a set of related JSON documents, and you can have multiple
collections.  On the command line type:</p>

<pre><code>dataset init publications.ds
</code></pre>

<p>where &lsquo;publications.ds&rsquo; is the arbitrary name you want to give the collection.
Dataset (if successful) will respond with a line like:</p>

<pre><code>export DATASET=publications.ds
</code></pre>

<p>You can copy and paste this command to the command line - it&rsquo;s a shortcut to
avoid having to type the collection name every time you call the dataset
command.  If you look in you current directory you&rsquo;ll see a directory on
your file system called &lsquo;collection_name&rsquo;.  This is where all your JSON
documents will be stored.</p>

<p>Let&rsquo;s create some documents!  Type:</p>

<pre><code>dataset create 1 '{&quot;arxiv&quot;:1711.03979,&quot;doi&quot;:&quot;10.3847/1538-4357/aa9992&quot;}'
dataset create 2 '{&quot;arxiv&quot;:1507.08280,&quot;doi&quot;:&quot;10.1093/mnras/stv1793&quot;}'
dataset create 3 '{&quot;arxiv&quot;:1305.6004,&quot;doi&quot;:&quot;10.1051/0004-6361/201321484&quot;}'
</code></pre>

<p>In these examples the number is our document name (in this example it&rsquo;s an
imaginary numbering system) and the JSON file contains
the doi and arxiv identifier of an article.</p>

<p>We can then look at what documents we have by typing</p>

<pre><code>dataset keys
</code></pre>

<p>And we can look at a document by typing</p>

<pre><code>dataset read 1
</code></pre>

<p>We can make changes to our documents</p>

<pre><code>dataset update 3 '{&quot;arxiv&quot;:1305.6005,&quot;doi&quot;:&quot;10.1051/0004-6361/201321484&quot;}'
</code></pre>

<p>And remove documents</p>

<pre><code>dataset delete 1
</code></pre>

<p>We can also pull out subsets of documents.  Let&rsquo;s find documents with and arxiv
id of 1305.6005:</p>

<pre><code>dataset keys '(eq .arxiv '1305.6005')'
</code></pre>

<p>&lsquo;eq&rsquo; indicates we want our field to be equal to the given value. Other options
are listed
<a href="https://caltechlibrary.github.io/dataset/docs/dataset/keys.html">here</a>
The &lsquo;.&rsquo; notation indicates what field from the json file we want to look at.</p>

<p>#Combining with APIs</p>

<p>Let&rsquo;s say we want to get citation counts for all the articles in our dataset.
We&rsquo;re going to use the Dimensions API.  Let&rsquo;s first do an example of a manual
API call</p>

<pre><code>curl https://metrics-api.dimensions.ai/doi/10.1051/0004-6361/201321484
</code></pre>

<p>We get back a JSON file with some useful data.  Let&rsquo;s say we want to add just
the &lsquo;times_cited&rsquo; value it to our dataset.<br />
First we&rsquo;ll save the API results to a file, ust the jsoncols tool to extract
the field, and then use the join command to add the information to
dataset.</p>

<pre><code>curl https://metrics-api.dimensions.ai/doi/10.1051/0004-6361/201321484 &gt; dimensions.json
jsoncols -i dimensions.json .times_cited
dataset -i dimensions.json join update 3 
dataset read 3
</code></pre>

<p>To use the join command we meed to know the record we&rsquo;re updating (&lsquo;3&rsquo; in this
case).  We also have two options - &lsquo;update&rsquo; that adds new fields but doesn&rsquo;t change existing
data and &lsquo;overwrite&rsquo; which will update all fields in common.</p>

<p>This is annoying to do by hand.  We want to run this automatically for all publications
in our dataset collection.  We need to write a short script to carry out this
operation.</p>

<p>```
for KY in $(dataset keys); do</p>

<pre><code>curl
</code></pre>

<p>#Google Docs</p>

<hr />

<p>Previous: <a href="00-intro-json-apis.html">JSON and APIs</a><br />
Next: <a href="02-combining-apis.md">Combining APIs with Dataset</a></p>

</section>

<footer>
<span>&copy; Lesson Contributors</span>
<span><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img
alt="Creative Commons License" style="vertical-align: middle;"
src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a></span>
<span>This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution
4.0 International License</a></span>
</footer>
</body>
</html>
